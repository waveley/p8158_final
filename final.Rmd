---
title: "P8158 Final"
author: "Waveley Qiu (wq2162)"
date: "2022-04-14"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(haven)
library(psych)
library(GPArotation)
library(naniar)
library(gtsummary)
```

```{r}
dataset <- readxl::read_excel("data/Athlete_Non-Athlete MH Survey - ALL DATA.xlsx", 
                              sheet = "athlete_fin") %>% 
  slice(-1) %>%   
  replace_with_na_all(condition = ~.x == "999") %>%
  janitor::clean_names()

dataset_no_na <- dataset %>% 
  select(-c("shield_dts", "date")) %>% 
  na.omit()

athletes <- dataset %>% filter(athlete_yn == "1") %>% select(-c("shield_dts", "date"))
athletes %>% colnames()

athletes_no_na <- athletes %>% na.omit()

non_athletes <- dataset %>% filter(athlete_yn == "2")
```

## Adding COVID-19 Quarantine Weeks & Sport Hours Measures

0 to 7 weeks in quarantine ("s)

```{r}
table(athletes$bub_size %>% as.numeric())
hist(athletes$play_hrs %>% as.numeric())

athletes <-
  athletes %>% 
  mutate(
    weeks_cat = weeks_sd %>% as.factor(),
    bubble_cat = bub_size %>% as.numeric(),
    play_hrs = play_hrs %>% as.numeric(),
    play_hrs_cat = case_when(
      play_hrs < 5 ~ "less than 5 hrs",
      5 <= play_hrs & play_hrs < 10 ~ "between 5 and 10 hrs",
      10 <= play_hrs & play_hrs < 15 ~ "between 10 and 15 hrs",
      15 <= play_hrs & play_hrs < 20 ~ "between 15 and 20 hrs",
      20 <= play_hrs & play_hrs < 25 ~ "between 20 and 25 hrs",
      25 <= play_hrs & play_hrs < 30 ~ "between 25 and 30 hrs",
      30 <= play_hrs ~ "30 or more hours"
    )
)
```

## Interested Variables

```{r}
features <- c("weeks_cat", "bubble_cat", "play_hrs_cat", "cnsdr_ath", "sprt_goals", "frnds_ath", "think_sprt", "sprt_lvl")
athletes[,features]
```

## Construct Reliability: Dedication to Sport/ athlete identity

```{r}
dedication_to_sport <- c("cnsdr_ath", "sprt_goals", "frnds_ath","sprt_impt", "think_sprt","bad_sprt","dprs_sprt")

table(athletes$happy)
selected_features <- athletes[,dedication_to_sport] %>% map_df(., as.numeric)

athlete_alpha <- psych::alpha(selected_features %>% as.matrix())
athlete_alpha

```
Chronbach's alpha is 74, with a 95 \% confidence interval of (0.70, 0.78).

## Construct Reliability: Resilience
```{r}
resilience <- c("bounce", "strs_evnt", "strs_rcvr", "snap_back","difficult","setbacks")
selected_resilience <- athletes[, resilience] %>% map_df(., as.numeric)
resilience_alpha <-  psych::alpha(selected_resilience %>% as.matrix())
resilience_alpha
athletes$fruit_veg
```

Chronbach's alpha is 0.89, with a 95 \% confidence interval of (0.87, 0.90).

## Latent Variables

LV1:dedication_to_sport
CNSDR_ATH: I consider myself an athlete
SPRT_GOALS: I have many goals related to sport
FRNDS_ATH: Most of my friends are athlete
SPRT_IMPT: Sport is the most important part of my life
THINK_SPRT: I spend more time thinking about sport than anything else
SPRT_LVL: Sport level

LV2:positive_outlook
HAPPY: Happy
INT_LIFE: Interested in life
SATISFIED: Satisfied
CONT_SOC: That you had something important to contribute to society

LV3:interaction_society
BELONG: That you belonged to a community (like a social group or neighbourhood)
BET_SOC: That our society is becoming a better place for people like you
PEOPLE_GOOD: That people are basically good
SENSE_SOC: That the way our society works makes sense to you

LV4: maturity
LIKE_PER: That you liked most parts of your personality
RESPONSIBLE: Good at managing the responsibilities of your daily life
WARM_REL: That you had warm and trusting relationships with others
CHAL_EXP: That you had experiences that challenged you to grow and become a better person
EXP_IDEA: Confident to think or express your own ideas and opinions
MEANING: That your life has a sense of direction or meaning to it

LV5: resilience
BOUNCE: I ten-d to bounce back quickly after hard times
STRS_EVNT: I have a hard time making it through stressful events
STRS_RCVR: It does not take me long to recover from a stressful event
SNAP_BACK: It is hard for me to snap back when something bad happens
DIFFICULT: I usually come through difficult times with little trouble
SETBACKS: I tend to take a long time to get over setbacks in my life

## factor diagram
```{r}
fa.diagram(mod_5,digits = 2,simple = TRUE, rsize = 2)

model_5 = "
dedication_to_sport = ~CNSDR_ATH + SPRT_GOALS + FRNDS_ATH + SPRT_IMPT + THINK_SPRT + SPRT_LVL
positive_outlook = ~ HAPPY + INT_LIFE + SATISFIED + CONT_SOC
interaction_society = ~ BELONG + BET_SOC + PEOPLE_GOOD + SENSE_SOC 
maturity = ~ LIKE_PER + RESPONSIBLE + WARM_REL +  CHAL_EXP + EXP_IDEA + MEANING
resilience = ~ BOUNCE + STRS_EVNT + STRS_RCVR + SNAP_BACK + DIFFICULT + SETBACKS
"
```

## CFA
```{r}
library(lavaan)
mod_5_cfa = cfa(model_5, data =features1,
                #ordered = names(features1),
                estimator = "WLSMV",
                std.lv=TRUE)

summary(mod_5_cfa, fit.measure= TRUE)
```

## Modificaition Indice (???)
```{r}
modindices(mod_5_cfa, power = TRUE, sort = TRUE, minimum.value = 10) 
```







